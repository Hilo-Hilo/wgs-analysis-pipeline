# WGS Analysis Pipeline - Local 16GB RAM Configuration
# Optimized settings for local machines with 16GB RAM

# =============================================================================
# ENVIRONMENT CONFIGURATION
# =============================================================================

# Conda environment name
CONDA_ENV=wgs_analysis

# CPU threads (conservative for memory management)
THREADS=4

# =============================================================================
# INPUT/OUTPUT DIRECTORIES
# =============================================================================

# Standard directory structure
RAW_DATA_DIR=data/raw
PROCESSED_DATA_DIR=data/processed
REFERENCE_DIR=data/reference
RESULTS_DIR=results
LOG_DIR=logs
TEMP_DIR=temp

# Sample configuration
SAMPLE_ID=LOCAL_SAMPLE
RG_PLATFORM=ILLUMINA
RG_LIBRARY=WGS

# =============================================================================
# REFERENCE GENOMES
# =============================================================================

# Use GRCh38 reference genome
PRIMARY_REFERENCE=grch38
GRCH38_REFERENCE=${REFERENCE_DIR}/GRCh38/GRCh38_latest_genomic.fna

# =============================================================================
# MEMORY-OPTIMIZED SETTINGS
# =============================================================================

# Memory limits (conservative for 16GB systems)
MAX_MEMORY_FASTQC=2
MAX_MEMORY_BWA=10          # Leave 6GB for system
MAX_MEMORY_SAMTOOLS=3
MAX_MEMORY_BCFTOOLS=3
MAX_MEMORY_VEP=6

# Process sequentially to avoid memory conflicts
PARALLEL_JOBS=1

# =============================================================================
# QUALITY CONTROL SETTINGS
# =============================================================================

FASTQC_THREADS=2
FASTQC_MEMORY=2G

# Aggressive read cleaning to reduce downstream memory
FASTP_THREADS=4
FASTP_MIN_LENGTH=75
FASTP_QUALITY_THRESHOLD=25
FASTP_CUT_TAIL_QUALITY=25

# =============================================================================
# ALIGNMENT SETTINGS
# =============================================================================

# Memory-conservative BWA settings
BWA_THREADS=4
BWA_MEMORY=10G
BWA_BATCH_SIZE=10000000    # Smaller batches for memory efficiency

# Optional GPU alignment settings (DGX/Parabricks)
ALIGNMENT_USE_GPU=false
GPU_ALIGNER_DEFAULT=parabricks
GPU_COUNT_DEFAULT=1

# Conservative samtools settings
SAMTOOLS_THREADS=2
SAMTOOLS_MEMORY=3G
SAMTOOLS_SORT_MEMORY=2G

# =============================================================================
# VARIANT CALLING SETTINGS
# =============================================================================

# Memory-efficient bcftools settings
BCFTOOLS_THREADS=2
BCFTOOLS_MEMORY=3G
BCFTOOLS_MIN_BASE_QUALITY=20
BCFTOOLS_MIN_MAPPING_QUALITY=20

# Conservative filtering to reduce file sizes
VARIANT_MIN_DEPTH=8
VARIANT_MIN_QUALITY=30
VARIANT_MAX_DEPTH=100

# =============================================================================
# ANNOTATION SETTINGS
# =============================================================================

# Memory-conservative VEP settings
VEP_THREADS=2
VEP_MEMORY=6G
VEP_CACHE_SIZE=200MB
VEP_BUFFER_SIZE=1000       # Smaller buffer for memory efficiency

# Essential annotations only
VEP_DATABASE_LIST="gnomAD,ClinVar"

# =============================================================================
# RESOURCE MANAGEMENT
# =============================================================================

# Conservative resource monitoring
MIN_FREE_SPACE_GB=400
MAX_MEMORY_USAGE_PERCENT=85

# Aggressive cleanup for space management
KEEP_INTERMEDIATE_FILES=false
AUTO_CLEANUP=true
CLEANUP_TEMP_FILES=true

# Compression settings for space efficiency
COMPRESSION_LEVEL=9        # Maximum compression

# =============================================================================
# PERFORMANCE OPTIMIZATION
# =============================================================================

# Sequential processing to avoid memory pressure
ENABLE_PARALLEL_STEPS=false

# Checkpoint frequently for resume capability
ENABLE_CHECKPOINTING=true
CHECKPOINT_FREQUENCY=hourly

# Monitor system resources
ENABLE_RESOURCE_MONITORING=true
MEMORY_ALERT_THRESHOLD=90

# =============================================================================
# OUTPUT MANAGEMENT
# =============================================================================

# Generate essential outputs only
GENERATE_DETAILED_STATS=false
GENERATE_PLOTS=false
GENERATE_REPORTS=true

# File format preferences
USE_COMPRESSED_INTERMEDIATE=true
USE_BGZIP_COMPRESSION=true

# =============================================================================
# ERROR HANDLING
# =============================================================================

# Conservative error handling
STOP_ON_MEMORY_ERROR=true
RETRY_ON_TEMP_FAILURE=true
MAX_RETRIES=2

# Detailed logging for troubleshooting
ENABLE_DEBUG_LOGGING=true
LOG_RESOURCE_USAGE=true

# =============================================================================
# VALIDATION SETTINGS
# =============================================================================

# Thorough input validation
VALIDATE_INPUT_FILES=true
CHECK_AVAILABLE_MEMORY=true
CHECK_AVAILABLE_DISK=true

# Quality thresholds
MIN_MAPPING_RATE=75        # Lower threshold for problematic samples
MIN_VARIANT_COUNT=2000000  # Adjusted for filtered data

# =============================================================================
# 16GB SYSTEM SPECIFIC NOTES
# =============================================================================

# This configuration is specifically optimized for:
# - 16GB total RAM (leaving ~2GB for OS)
# - Local SSD storage (400GB+ recommended)
# - 4-8 CPU cores
# - Single-user workstation environment

# Expected resource usage:
# - Peak memory: ~14GB during alignment
# - Storage: 300-400GB for complete analysis
# - Runtime: 12-20 hours for 30x WGS

# Performance tips:
# - Close other applications during analysis
# - Use SSD storage for best performance
# - Monitor system temperature during long runs
# - Consider running overnight for long analyses